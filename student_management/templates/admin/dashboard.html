{% extends 'base.html' %}

{% block title %}Admin Dashboard - SRS{% endblock %}
{% block page_title %}Admin Dashboard{% endblock %}

{% block sidebar_menu %}
<a href="{% url 'admin_dashboard' %}" class="sidebar-link active">
    <i class="bi bi-speedometer2"></i> Dashboard
</a>
<a href="{% url 'admin_upload_csv' %}" class="sidebar-link">
    <i class="bi bi-cloud-upload"></i> Upload CSV
</a>
<a href="{% url 'admin_manual_entry' %}" class="sidebar-link">
    <i class="bi bi-pencil-square"></i> Manual Entry
</a>
<a href="{% url 'admin_performance' %}" class="sidebar-link">
    <i class="bi bi-graph-up-arrow"></i> Performance
</a>
{% endblock %}

{% block content %}
<!-- Stats Row -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="stat-card bg-white h-100">
            <div class="stat-icon" style="background:rgba(99,102,241,0.12);">
                <i class="bi bi-people-fill" style="color:#6366f1;"></i>
            </div>
            <div class="stat-value">{{ total_students }}</div>
            <div class="stat-label">Total Students</div>
            <div class="mt-2">
                <span class="badge badge-soft-primary rounded-pill px-3">Enrolled</span>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card bg-white h-100">
            <div class="stat-icon" style="background:rgba(34,197,94,0.12);">
                <i class="bi bi-book-fill" style="color:#22c55e;"></i>
            </div>
            <div class="stat-value">{{ total_subjects }}</div>
            <div class="stat-label">Total Subjects</div>
            <div class="mt-2">
                <span class="badge badge-soft-success rounded-pill px-3">Active</span>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card bg-white h-100">
            <div class="stat-icon" style="background:rgba(245,158,11,0.12);">
                <i class="bi bi-clipboard2-data-fill" style="color:#f59e0b;"></i>
            </div>
            <div class="stat-value">{{ total_results }}</div>
            <div class="stat-label">Results Recorded</div>
            <div class="mt-2">
                <span class="badge badge-soft-warning rounded-pill px-3">Submitted</span>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div><i class="bi bi-activity me-2" style="color:#6366f1;"></i>Recent Activity</div>
        <ul class="nav nav-pills" id="activityTab">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#recentResults">Recent
                    Results</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="pill" data-bs-target="#allStudents">All Students</button>
            </li>
        </ul>
    </div>
    <div class="card-body p-0">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="recentResults">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Student Name</th>
                                <th>Roll No</th>
                                <th>Subject</th>
                                <th>Marks</th>
                                <th>Grade</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in recent_results %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <div
                                            style="width:32px;height:32px;border-radius:50%;background:rgba(99,102,241,0.1);color:#6366f1;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:0.8rem;">
                                            {{ result.student.user.first_name|slice:":1"|upper }}
                                        </div>
                                        <strong>{{ result.student.user.first_name }}</strong>
                                    </div>
                                </td>
                                <td><span class="badge badge-soft-primary">{{ result.student.roll_number }}</span></td>
                                <td>{{ result.subject.name }}</td>
                                <td>
                                    <strong
                                        style="color:{% if result.marks >= 75 %}#16a34a{% elif result.marks >= 50 %}#ca8a04{% else %}#dc2626{% endif %};">
                                        {{ result.marks }}
                                    </strong>/100
                                </td>
                                <td>
                                    {% if result.marks >= 90 %}
                                    <span class="badge badge-soft-success">A+</span>
                                    {% elif result.marks >= 75 %}
                                    <span class="badge badge-soft-success">A</span>
                                    {% elif result.marks >= 60 %}
                                    <span class="badge badge-soft-primary">B</span>
                                    {% elif result.marks >= 50 %}
                                    <span class="badge badge-soft-warning">C</span>
                                    {% else %}
                                    <span class="badge badge-soft-danger">F</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted">
                                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>No results uploaded yet.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-pane fade" id="allStudents">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Roll No</th>
                                <th>Name</th>
                                <th>Username</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td><span class="badge badge-soft-primary">{{ student.roll_number }}</span></td>
                                <td>{{ student.user.first_name }}</td>
                                <td>
                                    <span class="text-muted">@{{ student.user.username }}</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center py-5 text-muted">
                                    <i class="bi bi-person-x fs-1 d-block mb-2"></i>No students found.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}